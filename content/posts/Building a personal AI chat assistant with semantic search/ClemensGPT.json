{
  "name": "ClemensGPT",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {
          "allowedOrigins": "https://clemens.ms,https://www.clemens.ms",
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -576,
        -64
      ],
      "id": "b273c4bc-aa4f-421c-9e31-6c929e750e5d",
      "name": "When chat message received",
      "webhookId": "070147ce-4deb-41d6-9648-5e61532d80c4"
    },
    {
      "parameters": {
        "sessionKey": "userId"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -384,
        160
      ],
      "id": "4b977177-528d-45ff-a372-ad922714f66b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are ClemensGPT, Clemens' blog assistant. Use the search tool first for any questions about Clemens, his work, or Azure topics. Be concise (max 8 sentences). Cite sources as [title](url). For employment questions, direct to clemens@navatron.com."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -384,
        -64
      ],
      "id": "07aa532b-0427-46ed-ba8f-6b2ecbf19c61",
      "name": "Clemens AI Agent",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -576,
        -464
      ],
      "id": "b7191a66-32b3-4c3f-88e2-978bd6712d13",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "url": "https://clemens.ms/index.json",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -352,
        -464
      ],
      "id": "5dd45023-1755-4ad7-b9c2-ab8ff04662d5",
      "name": "Get All Pages"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        432,
        -464
      ],
      "id": "15b5114a-cb2e-4087-b3b5-068510721ea7",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a0d5ef86-0c97-4179-8c51-a07480ccba01",
              "name": "id",
              "value": "={{ $json.id_hash }}",
              "type": "string"
            },
            {
              "id": "539e240a-f88f-4d6c-919c-4f7c1346d88c",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "5a5da48c-915b-4c2a-8453-e9b17aa753b1",
              "name": "content",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "9ad64c45-9636-42c8-b415-eb14dc271506",
              "name": "url",
              "value": "={{ $json.url }}",
              "type": "string"
            },
            {
              "id": "046d3f46-32f3-475a-8fa2-f116562dc5ef",
              "name": "keywords",
              "value": "={{ $json.keywords }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        128,
        -368
      ],
      "id": "f8fc4519-ced7-4060-b055-340136780eaa",
      "name": "Prep Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a78b6c8f-a41d-451c-9d0d-30a1a8e19081",
              "name": "data[0].embedding",
              "value": "={{ $json.data[0].embedding }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        128,
        -560
      ],
      "id": "84ad131b-0bee-4394-8b1a-96f63bda1561",
      "name": "Embeddings"
    },
    {
      "parameters": {
        "content": "## Upload my Blog content to Azure AI Search Index",
        "height": 416,
        "width": 1664
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        -624
      ],
      "typeVersion": 1,
      "id": "dd9feb5c-4289-4bd4-bb1c-4e84d2807c58",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ClemensGPT",
        "height": 544,
        "width": 752
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        -176
      ],
      "typeVersion": 1,
      "id": "fe46152d-a5e6-43b1-bc48-cdf4101b15b0",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://cleme-mdunqsnd-eastus2.cognitiveservices.azure.com/openai/deployments/text-embedding-3-small/embeddings",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api-version",
              "value": "2023-05-15"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "input",
              "value": "={{ $json.content }}"
            },
            {
              "name": "model",
              "value": "text-embedding-3-small"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -128,
        -560
      ],
      "id": "beae79ba-509c-43e9-a3f4-f4d771c4d92b",
      "name": "Generate embeddings",
      "credentials": {
        "azureOpenAiApi": {
          "id": "nth2SzJ0CDUbdfjw",
          "name": "Azure Open AI account"
        },
        "httpHeaderAuth": {
          "id": "xLj2uaobS6RAJWNe",
          "name": "text-embedding-3-small"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://clemens.search.windows.net/indexes/clemens/docs/index",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api-version",
              "value": "2025-05-01-preview"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"value\": [\n    {\n     \"@search.action\": \"mergeOrUpload\",\n     \"id\": {{ JSON.stringify($json.id) }},\n     \"title\": {{ JSON.stringify($json.title) }},\n     \"content\": {{ JSON.stringify($json.content) }},\n     \"url\": {{ JSON.stringify($json.url) }},\n     \"keywords\": {{ JSON.stringify($json.keywords) }},\n     \"vector\": [\n        {{ $json.data[0].embedding }}\n      ]\n   }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        640,
        -464
      ],
      "id": "13caed3f-4716-4e50-b9eb-7e6c7aa52f2d",
      "name": "Upload embeddings to Vector Store",
      "credentials": {
        "httpHeaderAuth": {
          "id": "SJNE4kVouUb2i5MX",
          "name": "clemens Search service"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Search Clemens' blog content directly from Azure AI Search. Use this tool for any questions about Clemens, his work, projects, Azure expertise, and published content.",
        "method": "POST",
        "url": "https://clemens.search.windows.net/indexes/clemens/docs/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api-version",
              "value": "2025-05-01-preview"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"search\": \"{{ $json.chatInput }}\",\n  \"queryType\": \"semantic\",\n  \"semanticConfiguration\": \"clemens\",\n  \"select\": \"title,content,url,keywords\",\n  \"top\": 3\n}",
        "options": {
          "timeout": 15000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -64,
        160
      ],
      "id": "3e1daf9b-2f7d-4192-b086-9c43f9273de4",
      "name": "Direct Azure Search Tool",
      "credentials": {
        "httpHeaderAuth": {
          "id": "SJNE4kVouUb2i5MX",
          "name": "clemens Search service"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-5-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        -544,
        160
      ],
      "id": "265b47c1-a2ed-4adf-8b03-ecb542b5e66d",
      "name": "Azure OpenAI Chat Model",
      "credentials": {
        "azureOpenAiApi": {
          "id": "nth2SzJ0CDUbdfjw",
          "name": "Azure Open AI account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -224,
        160
      ],
      "id": "357cf20b-9f81-400d-a9a7-807a77b72e88",
      "name": "Calculator"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Clemens AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Clemens AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get All Pages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Pages": {
      "main": [
        [
          {
            "node": "Generate embeddings",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prep Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Upload embeddings to Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prep Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Embeddings": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate embeddings": {
      "main": [
        [
          {
            "node": "Embeddings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Direct Azure Search Tool": {
      "ai_tool": [
        [
          {
            "node": "Clemens AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Clemens AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "Clemens AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "912f6289-852f-48bb-b737-b2678d62f1ac",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bbe0c6dfc1c93248c009821e55624e7bb28f6e67f3f1b7a2a532022816147d46"
  },
  "id": "S6J4WPiZgNARunch",
  "tags": []
}